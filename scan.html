<!-- scan.html -->
<!DOCTYPE html><html lang="ja">
<head><meta charset="utf-8"/><title>抽選中…</title>
<style>body{font-size:1.2rem;text-align:center;padding:1rem}</style>
</head>
<body>
  <p>抽選中です…少々お待ちください</p>
<script type="module">
  import { initializeApp } 
    from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
  import { getDatabase, ref, set } 
    from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

 // ← ここを Firebase コンソールからコピーした設定で置き換え
  const firebaseConfig = {
    apiKey: "AIzaSyAyLd3jvdVXikgOXrni3HwlDNUieeZAhH8",
    authDomain: "qryf-11545.firebaseapp.com",
    databaseURL: "https://qryf-11545-default-rtdb.firebaseio.com",
    projectId: "qryf-11545",
    storageBucket: "qryf-11545.appspot.com",      // ← ここに注意
    messagingSenderId: "539005507453",
    appId: "1:539005507453:web:9faf1d69b175a50ce41e14"
  };
  // Firebase 初期化
  const app = initializeApp(firebaseConfig);
  const db  = getDatabase(app);

  // 書き込み → リダイレクト or エラー表示
  set(ref(db, `scans/${qrId}`), true)
    .then(()=> set(ref(db, `users/${uid}`), true))
    .then(()=>{
      location.replace(`result/${encodeURIComponent(rank)}.html`);
    })
    .catch(()=>{
      document.body.innerHTML =
        '<p>※このQRは既に抽選済みです。</p>';
    });
</script>
</body>
</html>
